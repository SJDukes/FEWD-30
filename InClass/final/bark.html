<!Doctype HTML>
<html>
  <head>
    <title>BarkPark</title>
    <link rel="stylesheet" href="stylesheets/all.css" media="screen">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css">
    <link rel="stylesheet" href="stylesheets/small.css" media="(max-width: 410px)">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
  </head>
  <body>
    <header class="header">
      <img id="logo" src="images/logo.png" width="140 " height="200" alt="logo" />
      <div>
        <form class="form-options" action="index.html" method="post">
          <label class ="labelHeader">Park Size</label>
          <label class ="radioButton" ><input  name="park-size" type="radio" value="All" checked >All</label>
          <label class ="radioButton" ><input  name="park-size" type="radio" value="Small Parks">Small Parks</label>
          <label class ="radioButton" ><input  name="park-size" type="radio" value="Big Parks">Big Parks</label>

          <label class ="labelHeader">Dog Size</label>
          <label class ="radioButton" ><input  name="dog-size" type="radio" value="All" checked >All</label>
          <label class ="radioButton" ><input  name="dog-size" type="radio" value="Small Dogs">Small Dogs</label>
          <label class ="radioButton" ><input  name="dog-size" type="radio" value="Big Dogs">Big Dogs</label>

          <label class ="labelHeader">On/Off Leash</label>
          <label class ="radioButton" ><input  name="leash" type="radio" value="All" checked >All</label>
          <label class ="radioButton" ><input  name="leash" type="radio" value="On Leash">On Leash</label>
          <label class ="radioButton" ><input  name="leash" type="radio" value="Off Leash">Off Leash</label>

          <input class="buttons"type="submit" value="Submit">
        </form>
      </div>
    </header>
    <main>
      <div id="map">
        <!--This is where the map goes-->
      </div>
    </main>
    <footer>
      <p>Woof! 2015</p>
      <div class="like">
        <a href="#" class="like-link">Like</a>
        (<span class="like-count">1415</span>)
      </div>
    </footer>
    <script type="text/javascript">

    //This sets the map coordinates so that it looks at SF with a particular focus
    var map = L.map('map', {
        center: [37.779, -122.443],
        zoom: 12
    });

    //Here we establish the map tile and the access code to retrieve it
    var accessToken = 'pk.eyJ1Ijoic2R1a2VzIiwiYSI6ImZuTW80czQifQ.3pf72TkZauDP9mbYqlcIXQ';
    var url = 'https://{s}.tiles.mapbox.com/v4/sdukes.m8434ap4/{z}/{x}/{y}.png?access_token=' + accessToken;
    var tileLayer = L.tileLayer(url, {
       attribution: '<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>'
     }).addTo(map); //We are seeding the page load with a map automatically
     var geoJsonLayer;
     $.get('https://a.tiles.mapbox.com/v4/sdukes.m8434ap4/features.json?access_token=' + accessToken, function(data) {
       // Now that we've got our data we can just let leaflet read it and add it to the map
         geoJsonLayer = L.geoJson(data, {
           onEachFeature: function(feature, layer) {
             layer.bindPopup(feature.properties.title + ' ' +
             '<br>' + feature.properties.description +
             '<br>' + feature.properties.Acreage + ' Acres'
             );
           },
         }).addTo(map);//We are seeing the page load with ALL parks to start
        // console.log(data);
     });

     //Watch for the submit action so that we can start querying parks
    var formSubmit = document.querySelector(".form-options");

    function submitClicked(clickEvent) {
      event.preventDefault();

      var parkSize = clickEvent.target["park-size"];
      var dogSize = clickEvent.target["dog-size"];
      var leash = clickEvent.target["leash"];

      //Create object that contains answers to the following
      //What size parks the user is looking for
      //What kind of dogs they want to be around
      //If they are looking for on or off leash parks
      var userInput = {
        parkSize: parkSize.value,
        dogSize: dogSize.value,
        leash: leash.value
      }
      //Call the function
      updateParks(userInput)

    }

    formSubmit.addEventListener("submit", submitClicked);

    //Take user input and add the fitered results to the map
    function updateParks (userInput) {
      //Remove any previous layers on the map
      geoJsonLayer.clearLayers()

      //Get the geoJson infomation to that contains the parks and all their data points
      $.get('https://a.tiles.mapbox.com/v4/sdukes.m8434ap4/features.json?access_token=' + accessToken, function(Acres) {
      //console.log(Acres);

        //Create a container to hold all the results in
        var featureCollection = {
          features: [],
          type: "FeatureCollection"
        };

        // filter data based on userInput
        for (var i = 0; i < Acres.features.length; i++) {
          var isBigPark = Acres.features[i].properties.Acreage > 1;
          var isBigDog = Acres.features[i].properties.ParkServiceArea === "PSA 1" || Acres.features[i].properties.ParkType === "Regional Park";
          var isOffLeash = Acres.features[i].properties.ParkType !== "Neighborhood Park or Playground" && Acres.features[i].properties.Acreage > 1;

          //The logic below makes sure that we are using AND clauses with our
          //park criteria. We will only show parks that match all critetia provided
          var parkMatches = true;
            if (userInput.parkSize !=="All") {
              if (userInput.parkSize === "Small Parks" && isBigPark) {
                parkMatches = false;
              } else if (userInput.parkSize === "Big Parks" && !isBigPark) {
                parkMatches = false;
              }
            }

          var dogMatches = true;
           if (userInput.dogSize !=="All") {
            if (userInput.dogSize === "Small Dogs" && isBigDog) {
              dogMatches = false;
            } else if (userInput.dogSize === "Big Dogs" && !isBigDog) {
              dogMatches = false;
            }
          }

          var leashMatches = true;
           if (userInput.leash !=="All") {
            if (userInput.leash === "On Leash" && isOffLeash) {
              leashMatches = false;
            } else if (userInput.leash === "Off Leash" && !isOffLeash) {
              leashMatches = false;
            }
          }

          if (parkMatches && leashMatches && dogMatches) {
            featureCollection.features.push(Acres.features[i]);
          }
        }
         //This is where we actually later the data back on to the map
         geoJsonLayer.addData(featureCollection);
       });
    }

    //This is just for function to pretend that people like our page :)
    var findLike = document.querySelector(".like");
    var likeCount = document.querySelector(".like-count");

    function submitLike(event){
      event.preventDefault()
        var counter = parseInt(likeCount.textContent);
        counter = counter +1;
        likeCount.textContent= counter;
    }

    findLike.addEventListener("click", submitLike);
    </script>
  </body>
</html>
